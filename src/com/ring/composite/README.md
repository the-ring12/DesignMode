# 组合模式

组合多个对象形成树形结构以表示具有部分-整体关系的层次结构。组合模式让客户端可以统一对待单个对象和组合对象。

- Component（抽象构件）

  它可以是接口或抽象类，为叶子构件和容器构件对象声明接口，在该角色中可以包含所有子类共有行为的声明和实现。在抽象构件中定义了访问及管理它的子构建的方法，如增加子构件、删除子构件、获取子构件等。

- Leaf（叶子构件）

  它在组合结构中表示叶子结点对象，叶子结点没有子结点，它实现了在抽象构件中定义的行为。对于那些访问及管理子构件的方法，可以通过抛出异常、提示错误等方式进行处理。

- Composite（容器）

  它在组合结构中表示容器结点对象，容器结点包含子结点，某子结点可以是叶子结点，也可以是容器结点，他提供一个集合用于存储子结点，实现了在抽象构件中定义的行为，包括那些访问及管理子构件的方法，在其业务方法中可以递归调用其子结点的业务方法。

> 某软件公司要开发一个杀毒（Antivirus）软件，该软件既可以对某个文件夹（Folder）杀毒，也可以对某个指定的文件（File）杀毒。该杀毒软件还可以根据各类文件的特点为不同类型的文件提供不同的杀毒方式，例如图像文件（ImageFile）和文本文件（TextFile）的杀毒方法就有所差异。使用组合模式来设计该杀毒软件。


<img src="./Package%20composite.png" alt="组合模式">

### 透明组合模式

在透明组合模式中，抽象构件 Component 中声明了所有用于管理成员对象的方法，包括 add()、remove() 以及 getChild() 等方法。

这样做的好处时确保所有的构建类都有相同的接口。

透明组合模式的缺点时不够安全，因为叶子对象和容器对象在本质上是有区别的。

### 安全组合模式

在安全组合模式中，抽象构建 Component 中没有声明任何用于管理成员对象的方法，而是在 Component 类中声明并实现这些方法。

这种做法是安全的，因为根本不向叶子对象提供这些管理成员对象的方法，对于叶子对象，客户端不可能调用到这些方法。

安全组合模式的缺点是不够透明，因为叶子构件和容器构建具有不同的方法，且容器构件中那些用于管理成员对象的方法没有在抽象构件类中定义，因此客户端不呢个完全针对抽象编程，必须有区别地对待叶子构件和容器构件。

**组合模式的优点**

（1）可以清楚的定义分层次地复杂对象，表示对象的全部或部分层次，它让客户端忽略了层次差异，方便对整个层次结构进行控制。

（2）客户端可以一致地使用一个组合结构或其中单个对象，不必关心处理的是单个对象还是整个组合结构，简化了客户端代码。

（3）在组合模式中增加新的容器构件和叶子构件都很方便，无须对现有类库进行任何修改，符合开闭原则。

（4）为树形结构地面向对象实现提供了一种灵活的解决方案，通过叶子对象和容器对象地递归组合可以形成复杂地树形结构，但对树形结构的控制却非常简单。

**组合模式的缺点**

再增加新构件时很难对容器中的构件类型进行限制。有时候希望容器中只能有某些特定类型的对象，例如在某个文件夹中只能包含文本文件，在使用组合模式是不能依赖类型系统来施加这些约束，因为它们都来自相同的抽象层，在这种情况下必须通过在运行时进行类型检查来实现，这个实现过程较为复杂。

**组合模式适用环境**

（1）在具有整体和部分的层次结构中希望通过一种方式忽略整体与部分的差异，客户端可以一致地对待他们。

（2）在一个使用面向对象语言开发的系统中需要处理一个树形结构。

（3）在一个系统中能够分离出叶子对象和容器对象，而且它们的类型不固定，需要增加一些新的类型。